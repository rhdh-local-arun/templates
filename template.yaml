apiVersion: scaffolder.backstage.io/v1beta3
kind: Template
metadata:
   name: aws-infra-template
   title: AWS EKS + RDS + S3 Terraform Template
   description: Creates a Terraform project with EKS, RDS Postgres, and S3 bucket.
spec:
  owner: user:guest
  type: service

  parameters:
    # - title: Team Selection
    #   description: Choose a team fetched from an external dummy API.
    #   required: ['team']
    #   properties:
    #     team:
    #       type: string
    #       title: Select a Team
    #       ui:field: TeamSelector
    #       ui:options:
    #         apiUrl: 'https://dummyjson.com/users'
            
    - title: Select ClusterType and Approved Architect Designs 
      description: Choose a cluster / approvedDesigns fetch from ServiceNow.
      required: ['cluster','approvedDesign']
      properties:
        cluster:
          type: string
          title: Select a ClusterType
          ui:field: ServiceNowExtension
          ui:options:
            apiUrl: 'https://dev308515.service-now.com/api/now/table/x_1856211_archit_0_approved_clusters?sysparm_limit=10'
        approvedDesign:
          type: string
          title: Select a Approved Architecture Designs
          ui:field: ServiceNowApprovedArchDesign
          ui:options:
            apiUrl: 'https://dev308515.service-now.com/api/now/table/x_1856211_demoapp_architecture_approved_designs?sysparm_limit=10'   

    - title: Infrastructure Settings
      required:
        - cluster_name
        - db_name
        - s3_bucket_name
        - db_username
        - db_password
      properties:
        cluster_name:
          title: EKS Cluster Name
          type: string
          description: Name of the AWS EKS cluster

        db_name:
          title: RDS Database Name
          type: string
          description: Name of the RDS PostgreSQL database

        s3_bucket_name:
          title: S3 Bucket Name
          type: string
          description: Name of the S3 bucket to be created

        db_username:
          title: RDS Username
          type: string
          description: Username for RDS instance

        db_password:
          title: RDS Password
          type: string
          ui:field: Secret
          description: Password for RDS instance        

  steps:
    - id: log
      name: Log Selected Team
      action: debug:log
      input:
        message: >
          The selected team is: ${{ parameters.team }} ${{ parameters.cluster }} {{parameters.approvedDesign}}

  output:
    text:
      - title: Selected Team
        content: 'You selected: ${{ parameters.team }} ${{ parameters.cluster }} {{parameters.approvedDesign}}'
